<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可靠性门户 - 工具</title>
    <link rel="stylesheet" href="/css/reliablityLab/style.css">
    <style>
        :root {
            --sidebar-w: 240px;
            --radius-md: 12px;
            --primary: #6366f1;
            --primary-500: #8b5cf6;
            --bg-900: #0b1220;
            --text-100: #f8fafc;
            --text-300: #cbd5e1;
            --border: rgba(255, 255, 255, 0.08);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            color: var(--text-100);
            background: radial-gradient(1200px 600px at 10% 10%, rgba(99,102,241,0.12), transparent 60%),
                        radial-gradient(900px 500px at 90% 20%, rgba(139,92,246,0.12), transparent 60%),
                        linear-gradient(180deg, #0b1220 0%, #0e1627 100%);
        }

        .container-fluid { height: 100vh; }

        .sidebar {
            position: fixed; top: 0; left: 0; bottom: 0;
            width: var(--sidebar-w); padding: 24px 16px;
            background: rgba(17, 24, 39, 0.6);
            border-right: 1px solid var(--border);
            backdrop-filter: blur(12px);
        }
        .sidebar-sticky { position: sticky; top: 24px; }
        .nav { list-style: none; margin: 0; padding: 0; display: grid; gap: 8px; }
        .nav-link { display:flex; align-items:center; gap:10px; padding:10px 12px; color:var(--text-300); text-decoration:none; border-radius:10px; transition: all .2s; }
        .nav-link:hover { color:var(--text-100); background: rgba(99,102,241,0.15); transform: translateX(2px); }
        .nav-link.active { color:#fff; background: linear-gradient(135deg, rgba(99,102,241,0.35), rgba(139,92,246,0.35)); border: 1px solid rgba(255,255,255,0.08); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04); }

        main { margin-left: var(--sidebar-w); padding: 40px 48px; }
        .page { max-width: 1080px; margin: 0 auto; }

        .hero { padding: 24px 28px; border-radius: 16px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
        .hero h2 { margin: 0 0 10px 0; font-size: 24px; }
        .hero p { margin: 0; color: var(--text-300); }

        .tool-card { margin-top: 18px; padding: 20px; border-radius: 14px; background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); border: 1px solid var(--border); }
        .tool-actions { margin-top: 12px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .form-control { background: rgba(255,255,255,0.06); color: var(--text-100); border: 1px solid var(--border); padding: 10px 12px; border-radius: 10px; }
        .btn { display:inline-flex; align-items:center; gap:8px; padding: 10px 14px; border-radius: 10px; font-weight: 600; text-decoration: none; border: 1px solid var(--border); cursor: pointer; color:#fff; background: linear-gradient(135deg, var(--primary), var(--primary-500)); box-shadow: 0 6px 16px rgba(99,102,241,0.35); }
        .meta { margin-top: 10px; color: var(--text-300); font-size: 14px; }

        .output { margin-top: 14px; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.04); border: 1px solid var(--border); min-height: 40px; }

        @media (max-width: 720px) {
            :root { --sidebar-w: 0px; }
            .sidebar { position: static; width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); }
            main { margin-left: 0; padding: 24px; }
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row" style="height: 100vh;">
        <nav class="sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="/reliablityLab/index">首页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/reliablityLab/usageRate">工具</a>
                    </li>
                </ul>
            </div>
        </nav>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <div class="page">
                <section class="hero">
                    <h2>工具中心 · CSV/XLS 文件处理</h2>
                    <p>支持多文件选择与批量上传，自动校验文件类型并提供结果反馈。</p>
                </section>

                <section class="tool-card">
                    <div class="tool-actions">
                        <input type="file" id="fileInput" multiple accept=".csv,.xls" class="form-control">
                        <button id="processBtn" class="btn">上传文件</button>
                    </div>
                    <div id="fileList" class="meta"></div>
                    <div id="output" class="output"></div>
                </section>
            </div>
        </main>
    </div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');

    fileInput.addEventListener('change', () => {
        const files = fileInput.files;
        fileList.innerHTML = ''; // 清空之前的文件名

        if (files.length > 0) {
            const fileNames = Array.from(files)
                .map(file => file.name)
                .join('<br>'); // 以换行符分隔文件名
            fileList.innerHTML = `<strong>已选择的文件:</strong><br>${fileNames}`;
        }
    });

    document.getElementById('processBtn').addEventListener('click', () => {
        const files = fileInput.files;
        if (files.length === 0) {
            alert("请先选择文件！");
            return;
        }

        const formData = new FormData();
        let validFilesCount = 0;

        Array.from(files).forEach(file => {
            if (file.name.endsWith(".csv") || file.name.endsWith(".xls")) {
                formData.append('files', file);
                validFilesCount++;
            } else {
                alert(`${file.name} 不是有效的CSV或XLS文件。`);
            }
        });

        if (validFilesCount === 0) {
            alert("请选择有效的CSV或XLS文件进行上传！");
            return;
        }

        // 上传文件
        fetch('/reliablityLab/uploadCSVFiles', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应不是ok');
                }
                return response.json();
            })
            .then(result => {
                const outputMessage = result.message
                    ? result.message.replace(/\\n/g, '<br>')
                    : "上传成功！";

                const downloadLink = result.downloadLink ? `<br><a href="${result.downloadLink}" target="_blank">点击下载日志文件</a>` : "";

                document.getElementById('output').innerHTML = outputMessage + downloadLink;
            })
            .catch(error => {
                console.error('上传失败:', error);
                document.getElementById('output').textContent = "上传失败，请重试。";
            });
    });
</script>
</body>
</html>
